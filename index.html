<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Loop - Single Room Chat App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Supabase JS client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Custom font for a clean, modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">
    <div class="min-h-screen flex flex-col items-center justify-center p-4">

        <!-- Header/Navigation -->
        <header class="w-full max-w-4xl flex justify-between items-center py-6 px-4">
            <div class="text-2xl font-bold text-gray-100">College Loop.</div>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="#home" class="text-gray-300 hover:text-rose-400 transition duration-300">Home</a></li>
                    <li><a href="#about" class="text-gray-300 hover:text-rose-400 transition duration-300">About</a></li>
                    <li><a href="https://github.com/VidhuVi" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-rose-400 transition duration-300">GitHub (Developer)</a></li>
                </ul>
            </nav>
        </header>

        <!-- Hero Section -->
        <main class="flex-grow flex flex-col items-center justify-center w-full max-w-4xl text-center py-12 px-4">
            <div id="main-content" class="bg-gray-800 bg-opacity-80 p-8 md:p-12 rounded-3xl shadow-xl border border-rose-700 backdrop-blur-sm">
                <h1 class="text-4xl md:text-6xl font-extrabold mb-4 text-gray-50 leading-tight">
                    Welcome to <span class="text-rose-400">College Loop</span>
                </h1>
                <p class="text-lg md:text-xl text-gray-300 mb-8">
                    Connect instantly with your college community in a single, dedicated chat room.
                    Simple, fast, and focused on college life.
                </p>
                <a href="https://github.com/VidhuVi" target="_blank" rel="noopener noreferrer"
                   class="inline-block bg-rose-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg
                          hover:bg-rose-600 transform hover:scale-105 transition duration-300 ease-in-out
                          focus:outline-none focus:ring-4 focus:ring-rose-300">
                    Learn More on GitHub
                </a>
            </div>
            <!-- Message area for verification feedback -->
            <div id="verification-message" class="mt-8 text-center text-lg font-semibold hidden"></div>
        </main>

        <!-- About Section -->
        <section id="about" class="w-full max-w-4xl bg-gray-800 bg-opacity-70 p-8 md:p-12 mt-12 rounded-3xl shadow-lg border border-sky-700 backdrop-blur-sm">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-50 mb-6 text-center">About College Loop</h2>
            <p class="text-md md:text-lg text-gray-300 leading-relaxed mb-4">
                College Loop is designed to be your go-to communication hub for your college.
                Forget endless group chats and scattered conversations â€“ with a single, focused room,
                everyone in your college can easily connect, share updates, and discuss what matters most,
                all in real-time.
            </p>
            <p class="text-md md:text-lg text-gray-300 leading-relaxed">
                Developed by Vidhu, this app aims for a streamlined and secure chat experience.
                You can explore the project's development and technical inspirations on
                Vidhu's <a href="https://github.com/VidhuVi" target="_blank" rel="noopener noreferrer" class="text-rose-400 hover:underline">GitHub profile</a>.
                The initial idea and some foundational concepts were inspired by projects like
                <a href="https://github.com/Nirus2005" target="_blank" rel="noopener noreferrer" class="text-rose-400 hover:underline">Nirus2005's repository</a>.
            </p>
            <!-- Add more content like features, screenshots, or testimonials here -->
        </section>

        <!-- Footer -->
        <footer class="w-full max-w-4xl text-center py-8 px-4 mt-12 text-gray-400">
            &copy; <span id="current-year"></span> College Loop. Developed by Vidhu.
        </footer>

    </div>

    <script>
        // Set current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Initialize Supabase client
        // Vercel injects environment variables prefixed with NEXT_PUBLIC_ or VERCEL_ENV_
        // Make sure these are set in your Vercel project settings.
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL; // e.g., 'https://your-project-ref.supabase.co'
        const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY; // e.g., 'YOUR_ANON_KEY'

        // Only initialize Supabase if the environment variables are available
        let supabase = null;
        if (supabaseUrl && supabaseAnonKey) {
            supabase = Supabase.createClient(supabaseUrl, supabaseAnonKey);
        } else {
            console.error('Supabase environment variables (NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY) are not set. Email verification will not work.');
            // Optionally display a warning on the page for debugging during development
            const messageDiv = document.getElementById('verification-message');
            messageDiv.textContent = 'Configuration error: Supabase keys missing. Verification disabled.';
            messageDiv.classList.remove('hidden');
            messageDiv.classList.add('text-red-500');
        }

        // Function to handle email verification
        async function handleEmailVerification() {
            const urlParams = new URLSearchParams(window.location.search);
            const token_hash = urlParams.get('token_hash');
            const type = urlParams.get('type');
            const verificationMessageDiv = document.getElementById('verification-message');
            const mainContentDiv = document.getElementById('main-content'); // Get the main content div

            if (token_hash && type && supabase) {
                // Show a loading message
                verificationMessageDiv.textContent = 'Verifying your email... Please wait.';
                verificationMessageDiv.classList.remove('hidden');
                verificationMessageDiv.classList.add('text-blue-400');
                // Hide main content temporarily while verifying
                mainContentDiv.classList.add('hidden');

                try {
                    const { error } = await supabase.auth.verifyOtp({
                        token_hash: token_hash,
                        type: type
                    });

                    if (error) {
                        console.error('Email verification failed:', error.message);
                        verificationMessageDiv.textContent = `Email verification failed: ${error.message}. Please try again or contact support.`;
                        verificationMessageDiv.classList.remove('text-blue-400');
                        verificationMessageDiv.classList.add('text-red-500');
                    } else {
                        console.log('Email verified successfully!');
                        verificationMessageDiv.textContent = 'Your email has been successfully verified! Redirecting to College Loop...';
                        verificationMessageDiv.classList.remove('text-blue-400', 'text-red-500');
                        verificationMessageDiv.classList.add('text-green-400');

                        // Remove the query parameters from the URL and reload/redirect
                        // This makes the URL clean after verification
                        setTimeout(() => {
                            window.location.replace(window.location.origin + window.location.pathname);
                        }, 2000); // Redirect after 2 seconds
                    }
                } catch (e) {
                    console.error('An unexpected error occurred during verification:', e);
                    verificationMessageDiv.textContent = 'An unexpected error occurred during verification.';
                    verificationMessageDiv.classList.remove('text-blue-400');
                    verificationMessageDiv.classList.add('text-red-500');
                }
            } else if (urlParams.toString() !== '') {
                // If there are other unexpected query parameters (not token_hash/type)
                // or if supabase is not initialized, but params exist, we might inform the user.
                // For now, if no verification params, just let the landing page load.
                console.log("No email verification parameters found or Supabase not configured. Loading landing page.");
                mainContentDiv.classList.remove('hidden'); // Ensure main content is visible if no verification
            } else {
                // No verification parameters, just load the landing page
                mainContentDiv.classList.remove('hidden'); // Ensure main content is visible
            }
        }

        // Call the verification handler when the page loads
        document.addEventListener('DOMContentLoaded', handleEmailVerification);
    </script>
</body>
</html>
